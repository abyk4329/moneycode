<!doctype html>
<html lang="he" dir="rtl">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
	<meta name="apple-mobile-web-app-capable" content="yes">
	<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
	<meta name="theme-color" content="#F6F5F1">
	<title>××—×©×‘×•×Ÿ ×§×•×“ ×”×›×¡×£</title>
	<link href="https://fonts.googleapis.com/css2?family=Assistant:wght@400;600;700&display=swap" rel="stylesheet">
	<meta name="description" content="×’×œ×• ××ª ×§×•×“ ×”×›×¡×£ ×”××™×©×™ ×©×œ×›× ×¢×œ ×¤×™ ×ª××¨×™×š ×”×œ×™×“×” â€“ ××—×©×‘×•×Ÿ × ×•××¨×•×œ×•×’×™ ×‘×¢×‘×¨×™×ª, ×—×™× ××™ ×•××œ×’× ×˜×™.">
	<meta name="keywords" content="×§×•×“ ×”×›×¡×£, × ×•××¨×•×œ×•×’×™×”, ××—×©×‘×•×Ÿ × ×•××¨×•×œ×•×’×™, ×›×¡×£, ×©×¤×¢, ×§×•×“ ××™×©×™">
	<meta property="og:title" content="××—×©×‘×•×Ÿ ×§×•×“ ×”×›×¡×£">
	<meta property="og:description" content="×’×œ×• ××ª ×§×•×“ ×”×›×¡×£ ×”××™×©×™ ×©×œ×›× â€“ ×—×™×©×•×‘ × ×•××¨×•×œ×•×’×™ ××”×™×¨ ×•×§×œ×™×œ ×‘×¢×‘×¨×™×ª.">
	<meta property="og:image" content="Untitled (2000 x 150 px).png">
	<meta property="og:type" content="website">
	<meta property="og:locale" content="he_IL">

	<style>
		:root {
			/* New warm palette */
			--desert-rock: #A48D78;      /* ×—×•× ×‘×–' ×—××™× */
			--soft-sandstone: #CBB9A4;   /* ×‘×–' ×¢×“×™×Ÿ ×¢× × ×’×™×¢×” ×—××” */
			--creamed-oat: #E6DAC8;      /* ×©×× ×ª ×¢× × ×’×™×¢×” ×—×•×œ×™×ª */
			--porcelain-mist: #F4F1EA;   /* ×œ×‘×Ÿ ×—×-×§×¨××™ */
			--feather-white: #FAF9F6;    /* ×œ×‘×Ÿ × ×§×™ ×•×¨×š ×××•×“ */
			--light-gold: #E8D2B3;       /* ×–×”×‘ ×‘×”×™×¨ ×¢×“×™×Ÿ */
			--warm-gold: #D4A574;        /* ×–×”×‘ ×—× */
			--deep-brown: #6B5B4F;       /* ×—×•× ×¢××•×§ ×œ×˜×§×¡×˜ */

			/* Main variables */
			--bg: var(--feather-white);
			--card-bg: var(--porcelain-mist);
			--card-bg-2: var(--creamed-oat);
			--gold: var(--warm-gold);
			--gold-deep: var(--desert-rock);
			--gold-light: var(--light-gold);
			--text: var(--deep-brown);
			--border: var(--soft-sandstone);
			--muted: var(--desert-rock);
			--card-radius: 20px;
			--touch-min: 48px;
		}

		* {
			box-sizing: border-box;
		}

		html, body {
			height: 100%;
		}

		body {
			margin: 0;
			background: var(--bg);
			color: var(--text);
			font-family: 'Assistant', system-ui, -apple-system, Segoe UI, Roboto, 'Helvetica Neue', Arial;
			-webkit-font-smoothing: antialiased;
			display: flex;
			align-items: center;
			justify-content: center;
			min-height: 100svh;
		}

		main {
			min-height: 100svh;
			display: flex;
			align-items: center;
			justify-content: center;
			padding: calc(20px + env(safe-area-inset-top)) calc(20px + env(safe-area-inset-right)) calc(20px + env(safe-area-inset-bottom)) calc(20px + env(safe-area-inset-left));
		}

		.card {
			position: relative;
			overflow: visible;
			width: 100%;
			max-width: 800px;
			background: linear-gradient(145deg, var(--card-bg), var(--card-bg-2));
			border-radius: var(--card-radius);
			box-shadow: 
				0 15px 35px rgba(164, 141, 120, 0.12), 
				0 5px 15px rgba(164, 141, 120, 0.08),
				inset 0 1px 0 rgba(255, 255, 255, 0.3);
			backdrop-filter: blur(12px);
			-webkit-backdrop-filter: blur(12px);
			padding: 32px;
			border: 1px solid rgba(203, 185, 164, 0.4);
			-webkit-tap-highlight-color: transparent;
			text-align: center;
			animation: cardFloat 6s ease-in-out infinite;
		}

		@keyframes cardFloat {
			0%, 100% { transform: translateY(0px) scale(1); }
			50% { transform: translateY(-3px) scale(1.002); }
		}

		@keyframes shimmer {
			0% { background-position: -200% 0; }
			100% { background-position: 200% 0; }
		}

		@keyframes goldGlow {
			0%, 100% { box-shadow: 0 6px 16px rgba(212, 165, 116, 0.16), 0 2px 4px rgba(212, 165, 116, 0.08); }
			50% { box-shadow: 0 8px 24px rgba(212, 165, 116, 0.24), 0 4px 8px rgba(212, 165, 116, 0.12); }
		}

		.inner {
			display: grid;
			grid-template-columns: 1fr;
			gap: 18px;
		}

		h1 {
			margin: 0;
			font-size: clamp(1.2rem, 3.8vw, 1.6rem);
			text-align: center;
		}

		p.lead {
			margin: 0;
			color: var(--muted);
			text-align: center;
			font-size: clamp(0.95rem, 2.8vw, 1.05rem);
		}

		.field {
			display: flex;
			flex-direction: column;
			gap: 8px;
			align-items: center;
		}

		label {
			font-weight: 700;
			text-align: center;
		}

		input[type=date] {
			appearance: none;
			-webkit-appearance: none;
			padding: 14px 16px;
			border: 2px solid var(--border);
			border-radius: 16px;
			font-size: 1.1rem;
			background: var(--feather-white);
			color: var(--text);
			width: 100%;
			min-height: calc(var(--touch-min));
			transition: all .3s ease;
			box-shadow: inset 0 2px 4px rgba(164, 141, 120, 0.06);
		}

		input[type=date]:focus {
			outline: none;
			border-color: var(--gold);
			box-shadow: 
				inset 0 2px 4px rgba(164, 141, 120, 0.06),
				0 0 0 3px rgba(212, 165, 116, 0.15);
			transform: translateY(-1px);
		}

		.controls {
			display: flex;
			gap: 12px;
			margin-top: 8px;
			justify-content: center;
		}

		button {
			flex: 1;
			padding: 14px;
			border-radius: 12px;
			border: 0;
			font-weight: 700;
			font-size: 1rem;
			cursor: pointer;
			touch-action: manipulation;
			-webkit-tap-highlight-color: transparent;
			min-height: calc(var(--touch-min));
		}

		.btn-primary {
			background: linear-gradient(135deg, var(--gold), var(--gold-deep));
			color: var(--feather-white);
			text-shadow: 0 1px 2px rgba(107, 91, 79, 0.3);
			box-shadow: 0 6px 16px rgba(212, 165, 116, 0.16), 0 2px 4px rgba(212, 165, 116, 0.08);
			transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
			border-radius: 16px;
			padding: 14px 20px;
			letter-spacing: 0.03em;
			position: relative;
			overflow: hidden;
			animation: goldGlow 4s ease-in-out infinite;
		}

		.btn-primary::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
			transition: left 0.5s ease;
		}

		.btn-primary:hover::before {
			left: 100%;
		}

		.btn-primary:hover,
		.btn-primary:focus {
			background: linear-gradient(135deg, var(--warm-gold), var(--desert-rock));
			outline: 0;
			transform: translateY(-3px) scale(1.02);
			box-shadow: 0 12px 28px rgba(212, 165, 116, 0.24), 0 6px 12px rgba(212, 165, 116, 0.16);
		}

		.btn-ghost {
			background: rgba(244, 241, 234, 0.6);
			border: 2px solid var(--border);
			color: var(--text);
			transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
			border-radius: 16px;
		}

		.btn-ghost:hover,
		.btn-ghost:focus {
			background: var(--gold-light);
			border-color: var(--gold);
			transform: translateY(-2px);
			box-shadow: 0 6px 16px rgba(212, 165, 116, 0.12);
		}

		.result {
			margin-top: 16px;
			padding: 20px;
			border-radius: 18px;
			background: linear-gradient(145deg, rgba(232, 210, 179, 0.15), rgba(244, 241, 234, 0.25));
			border: 2px solid rgba(212, 165, 116, 0.2);
			text-align: center;
			font-weight: 700;
			color: var(--text);
			transition: all .5s cubic-bezier(.2, .9, .2, 1);
			opacity: 0;
			transform: translateY(12px) scale(0.95);
			box-shadow: 
				0 8px 20px rgba(164, 141, 120, 0.1),
				inset 0 1px 0 rgba(255, 255, 255, 0.3);
		}

		.result.visible {
			opacity: 1;
			transform: translateY(0) scale(1);
			animation: resultPulse 0.6s ease-out;
		}

		@keyframes resultPulse {
			0% { transform: scale(0.95); }
			50% { transform: scale(1.05); }
			100% { transform: scale(1); }
		}

		#paylink {
			opacity: 0;
			transform: translateY(8px) scale(0.95);
			transition: all .5s cubic-bezier(.16, .84, .44, 1);
		}

		#paylink.show {
			opacity: 1;
			transform: translateY(0) scale(1);
			animation: payBounce 0.6s ease-out 0.3s;
		}

		@keyframes payBounce {
			0% { transform: translateY(0) scale(1); }
			30% { transform: translateY(-4px) scale(1.02); }
			60% { transform: translateY(-1px) scale(1.01); }
			100% { transform: translateY(0) scale(1); }
		}

		/* Payment Section Styles */
		.payment-card {
			background: linear-gradient(145deg, var(--feather-white), var(--porcelain-mist));
			border: 2px solid var(--gold-light);
			border-radius: 20px;
			padding: 24px;
			text-align: center;
			box-shadow: 
				0 12px 28px rgba(212, 165, 116, 0.15),
				inset 0 1px 0 rgba(255, 255, 255, 0.4);
			transition: all .4s ease;
			animation: paymentGlow 3s ease-in-out infinite;
		}

		@keyframes paymentGlow {
			0%, 100% { 
				box-shadow: 
					0 12px 28px rgba(212, 165, 116, 0.15),
					inset 0 1px 0 rgba(255, 255, 255, 0.4);
			}
			50% { 
				box-shadow: 
					0 16px 35px rgba(212, 165, 116, 0.25),
					inset 0 1px 0 rgba(255, 255, 255, 0.4);
			}
		}

		.payment-icon {
			font-size: 3rem;
			margin-bottom: 12px;
			animation: bounce 2s ease-in-out infinite;
		}

		@keyframes bounce {
			0%, 100% { transform: translateY(0px); }
			50% { transform: translateY(-10px); }
		}

		.payment-card h3 {
			color: var(--text);
			font-size: 1.3rem;
			margin: 12px 0 8px;
			font-weight: 700;
		}

		.payment-text {
			color: var(--muted);
			font-size: 1rem;
			margin-bottom: 16px;
		}

		.payment-price {
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 12px;
			margin-bottom: 20px;
			flex-wrap: wrap;
		}

		.old-price {
			text-decoration: line-through;
			color: var(--muted);
			font-size: 1.1rem;
		}

		.new-price {
			font-size: 1.8rem;
			font-weight: 800;
			color: var(--warm-gold);
			text-shadow: 0 2px 4px rgba(212, 165, 116, 0.3);
		}

		.discount-badge {
			background: linear-gradient(135deg, #ff6b6b, #ee5a5a);
			color: white;
			padding: 4px 12px;
			border-radius: 20px;
			font-size: 0.85rem;
			font-weight: 700;
			animation: pulse 2s ease-in-out infinite;
		}

		@keyframes pulse {
			0%, 100% { transform: scale(1); }
			50% { transform: scale(1.05); }
		}

		.btn-payment {
			background: linear-gradient(135deg, var(--warm-gold), var(--desert-rock));
			color: var(--feather-white);
			padding: 16px 24px;
			border-radius: 20px;
			text-decoration: none;
			font-weight: 700;
			font-size: 1.1rem;
			display: block;
			margin: 0 auto 16px;
			transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
			box-shadow: 0 8px 20px rgba(212, 165, 116, 0.3);
			position: relative;
			overflow: hidden;
		}

		.btn-payment::before {
			content: '';
			position: absolute;
			top: 0;
			left: -100%;
			width: 100%;
			height: 100%;
			background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
			transition: left 0.6s ease;
		}

		.btn-payment:hover::before {
			left: 100%;
		}

		.btn-payment:hover {
			transform: translateY(-3px) scale(1.02);
			box-shadow: 0 12px 30px rgba(212, 165, 116, 0.4);
		}

		.payment-features {
			margin-top: 16px;
			display: flex;
			flex-direction: column;
			gap: 8px;
		}

		.feature {
			color: var(--text);
			font-size: 0.95rem;
			text-align: center;
			padding: 6px;
		}

		#payment-section {
			opacity: 0;
			transform: translateY(20px) scale(0.9);
			transition: all .6s cubic-bezier(.16, .84, .44, 1);
		}

		#payment-section.show {
			opacity: 1;
			transform: translateY(0) scale(1);
		}

		.logo-bottom {
			display: block;
			margin: 28px auto 8px;
			width: clamp(120px, 18vw, 200px);
			height: auto;
			opacity: 0.9;
			transition: all .6s cubic-bezier(.2, 1, .3, 1);
			filter: drop-shadow(0 4px 8px rgba(164, 141, 120, 0.15));
		}

		.logo-bottom:hover {
			transform: translateY(-6px) scale(1.05);
			opacity: 1;
			filter: drop-shadow(0 8px 16px rgba(164, 141, 120, 0.25));
			animation: logoGlow 2s ease-in-out infinite;
		}

		@keyframes logoGlow {
			0%, 100% { filter: drop-shadow(0 8px 16px rgba(164, 141, 120, 0.25)); }
			50% { filter: drop-shadow(0 12px 24px rgba(212, 165, 116, 0.35)); }
		}

		.code-ltr {
			direction: ltr;
			unicode-bidi: -webkit-override;
			letter-spacing: 8px;
			font-family: 'Courier New', Monaco, 'Cascadia Code', monospace;
			color: var(--warm-gold);
			text-shadow: 
				0 2px 4px rgba(212, 165, 116, 0.3),
				0 0 10px rgba(212, 165, 116, 0.2);
			font-size: clamp(1.8rem, 5vw, 2.8rem);
			font-weight: 800;
			background: linear-gradient(45deg, var(--warm-gold), var(--gold-light), var(--warm-gold));
			background-size: 200% 200%;
			background-clip: text;
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
			animation: shimmer 3s ease-in-out infinite;
			display: block;
			margin: 12px 0;
			text-align: center;
		}

		.error-banner {
			display: none;
			padding: 16px;
			border-radius: 16px;
			background: linear-gradient(145deg, rgba(164, 141, 120, 0.12), rgba(244, 241, 234, 0.2));
			border: 2px solid rgba(164, 141, 120, 0.25);
			color: var(--text);
			font-weight: 600;
			text-align: center;
			box-shadow: 0 4px 12px rgba(164, 141, 120, 0.1);
		}

		.meta {
			margin-top: 6px;
			color: var(--muted);
			font-size: 0.92rem;
			text-align: center;
		}

		.interpretations {
			margin-top: 12px;
			text-align: right;
		}

		.interpretations h3 {
			margin: 8px 0 6px;
			text-align: center;
		}

		.interpretations dl {
			display: grid;
			grid-template-columns: repeat(1, 1fr);
			gap: 8px;
		}

		.interpretations dt {
			font-weight: 700;
		}

		.interpretations dd {
			margin: 0 0 8px 0;
			color: var(--muted);
		}

		@media (max-width: 520px) {
			.card {
				padding: 20px;
			}
			.controls {
				flex-direction: column;
			}
			button {
				padding: 14px;
			}
		}
	</style>

	<script>
		// Generate improved favicon for mobile
		(function() {
			const svg = `<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 512 512' width='512' height='512'>
				<defs>
					<radialGradient id='bgGrad' cx='50%' cy='30%' r='70%'>
						<stop offset='0%' stop-color='#E8D2B3'/>
						<stop offset='70%' stop-color='#D4A574'/>
						<stop offset='100%' stop-color='#A48D78'/>
					</radialGradient>
					<linearGradient id='textGrad' x1='0%' y1='0%' x2='100%' y2='100%'>
						<stop offset='0%' stop-color='#FAF9F6'/>
						<stop offset='100%' stop-color='#F4F1EA'/>
					</linearGradient>
				</defs>
				<circle cx='256' cy='256' r='240' fill='url(#bgGrad)' stroke='#CBB9A4' stroke-width='8'/>
				<text x='256' y='200' font-family='Arial, sans-serif' font-size='120' font-weight='bold' text-anchor='middle' fill='url(#textGrad)'>â‚ª</text>
				<text x='256' y='340' font-family='Arial, sans-serif' font-size='80' font-weight='600' text-anchor='middle' fill='url(#textGrad)'>×§×•×“</text>
			</svg>`;			try {
				const b64 = btoa(svg);
				const link = document.createElement('link');
				link.rel = 'icon';
				link.href = 'data:image/svg+xml;base64,' + b64;
				document.head.appendChild(link);
			} catch(e) {
				const enc = encodeURIComponent(svg).replace(/'/g,'%27').replace(/\(/g,'%28').replace(/\)/g,'%29');
				const link = document.createElement('link');
				link.rel = 'icon';
				link.href = 'data:image/svg+xml;utf8,' + enc;
				document.head.appendChild(link);
			}
		})();

		// Add subtle background animation
		(function() {
			const style = document.createElement('style');
			style.textContent = `
				body::before {
					content: '';
					position: fixed;
					top: 0;
					left: 0;
					width: 100%;
					height: 100%;
					background: 
						radial-gradient(circle at 20% 30%, rgba(232, 210, 179, 0.1) 0%, transparent 50%),
						radial-gradient(circle at 80% 70%, rgba(244, 241, 234, 0.1) 0%, transparent 50%),
						radial-gradient(circle at 50% 50%, rgba(212, 165, 116, 0.05) 0%, transparent 50%);
					pointer-events: none;
					z-index: -1;
					animation: backgroundFlow 20s ease-in-out infinite;
				}
				
				@keyframes backgroundFlow {
					0%, 100% { opacity: 1; transform: scale(1) rotate(0deg); }
					50% { opacity: 0.7; transform: scale(1.1) rotate(2deg); }
				}
			`;
			document.head.appendChild(style);
		})();

		// Link manifest for PWA
		(function() {
			const mlink = document.createElement('link');
			mlink.rel = 'manifest';
			mlink.href = 'manifest.json';
			document.head.appendChild(mlink);
		})();
	</script>
</head>
<body>
	<main>
		<section class="card" aria-labelledby="title">
			<div class="inner">
				<h1 id="title">××—×©×‘×•×Ÿ ×§×•×“ ×”×›×¡×£</h1>
				<p class="lead">×”×–×™× ×• ××ª ×ª××¨×™×š ×”×œ×™×“×” ×›×“×™ ×œ×—×©×‘ ××ª ×§×•×“ ×”×›×¡×£ ×”× ×•××¨×•×œ×•×’×™</p>

				<div id="error" class="error-banner" role="alert" aria-live="assertive"></div>

				<div class="field">
					<label for="dob">×ª××¨×™×š ×œ×™×“×”</label>
					<input id="dob" type="date" lang="he-IL" aria-label="×ª××¨×™×š ×œ×™×“×”" />
				</div>

				<div class="controls">
					<button id="compute" class="btn-primary">×—×©×‘×•</button>
					<button id="clear" class="btn-ghost">× ×™×§×•×™</button>
				</div>

				<div id="output" class="result" role="status" aria-live="polite" style="display:none"></div>
				
				<!-- ×›×¤×ª×•×¨ ×ª×©×œ×•× ××™×™×“×™ -->
				<div id="payment-section" style="margin-top:16px;display:none;">
					<div class="payment-card">
						<div class="payment-icon">ğŸ’°</div>
						<h3>×¨×•×¦×™× ×œ×’×œ×•×ª ××ª ×”××©××¢×•×ª ×”××œ××”?</h3>
						<p class="payment-text">×§×‘×œ×• ×¤×™×¨×•×© ××¤×•×¨×˜ ×•××™×©×™ ×©×œ ×§×•×“ ×”×›×¡×£ ×©×œ×›×</p>
						<div class="payment-price">
							<span class="old-price">â‚ª15</span>
							<span class="new-price">×¨×§ â‚ª5</span>
							<span class="discount-badge">67% ×”× ×—×”!</span>
						</div>
						<a id="paylink" class="btn-payment" href="#" role="button" aria-hidden="true">
							ğŸ¯ ×§×‘×œ×• ××ª ×”×¤×™×¨×•×© ×”××œ× ×¢×›×©×™×•
						</a>
						<div class="payment-features">
							<div class="feature">âœ¨ ×¤×™×¨×•×© ××™×©×™ ×•××§×¦×•×¢×™</div>
							<div class="feature">ğŸ”® ×”×“×¨×›×” ×œ× ×™×¦×•×œ ×”×›×•×— ×”×›×¡×¤×™</div>
							<div class="feature">ğŸ’ ×˜×™×¤×™× ×œ×”×’×“×œ×ª ×”×©×¤×¢</div>
						</div>
					</div>
				</div>

				<div class="interpretations" id="interpretations" style="display:none">
					<h3>×¤×™×¨×•×©×™ ××¡×¤×¨×™× (1â€“9)</h3>
					<dl>
						<dt>1</dt><dd>×¨××©×•× ×™×•×ª, ×× ×”×™×’×•×ª, ×™×–××•×ª.</dd>
						<dt>2</dt><dd>×©×™×ª×•×£, ×¨×’×™×©×•×ª, ×ª××™×›×”.</dd>
						<dt>3</dt><dd>×™×¦×™×¨×ª×™×•×ª, ×ª×§×©×•×¨×ª, ×©××—×”.</dd>
						<dt>4</dt><dd>×™×¡×•×“, ×™×¦×™×‘×•×ª, ×¢×‘×•×“×” ×§×©×”.</dd>
						<dt>5</dt><dd>×—×•×¤×©, ×©×™× ×•×™, ×”×¨×¤×ª×§××•×ª.</dd>
						<dt>6</dt><dd>××—×¨×™×•×ª, ×‘×™×ª, ×©×™×¨×•×ª.</dd>
						<dt>7</dt><dd>×—×›××”, ×¤× ×™××™×•×ª, ×¨×•×—× ×™×•×ª.</dd>
						<dt>8</dt><dd>×©×¤×¢, ×›×•×— ×›×œ×›×œ×™, × ×™×¦×—×•×Ÿ.</dd>
						<dt>9</dt><dd>××•× ×™×‘×¨×¡×œ×™×•×ª, ×¡×™×•×, ×—××œ×”.</dd>
					</dl>
				</div>

				<div class="meta">×”×©×ª××©×• ×‘×‘×•×¨×¨ ×”×ª××¨×™×›×™× ×©×œ ×”××›×©×™×¨ ××• ×”×–×™× ×• ×ª××¨×™×š ×‘×¤×•×¨××˜ yyyy-mm-dd ××• dd/mm/yyyy</div>
				<img src="Untitled (2000 x 150 px).png" alt="×œ×•×’×•" class="logo-bottom" aria-hidden="true">
			</div>
		</section>
	</main>

	<script>
		function sumDigitsOnce(value) {
			const s = String(value).replace(/\D/g, '');
			if (!s) return 0;
			return s.split('').reduce((a, b) => a + Number(b), 0);
		}

		function digitalRoot(n) {
			n = Math.abs(Number(n) || 0);
			while (n > 9) {
				n = String(n).split('').reduce((a, b) => a + Number(b), 0);
			}
			return n;
		}

		const dob = document.getElementById('dob');
		const compute = document.getElementById('compute');
		const clearBtn = document.getElementById('clear');
		const out = document.getElementById('output');
		const err = document.getElementById('error');

		function showError(text) {
			err.textContent = text;
			err.style.display = 'block';
			out.style.display = 'none';
		}

		function clearError() {
			err.textContent = '';
			err.style.display = 'none';
		}

		function showOutput(d, m, y, total) {
			clearError();
			out.innerHTML = `×§×•×“ ×”×›×¡×£ ×©×œ×›× ×”×•×: <span class="code-ltr">${d} ${m} ${y} ${total}</span>`;
			out.style.display = 'block';
		}

		function parseDateInput(val) {
			if (!val) return null;
			if (dob.valueAsDate instanceof Date && !isNaN(dob.valueAsDate)) {
				const dt = dob.valueAsDate;
				return { day: dt.getDate(), month: dt.getMonth() + 1, year: dt.getFullYear() };
			}
			const iso = /^\s*(\d{4})-(\d{1,2})-(\d{1,2})\s*$/;
			let m = val.match(iso);
			if (m) return { year: Number(m[1]), month: Number(m[2]), day: Number(m[3]) };
			const parts = val.trim().split(/[\/\.\-\s]+/);
			if (parts.length === 3) {
				if (parts[0].length === 4) return { year: Number(parts[0]), month: Number(parts[1]), day: Number(parts[2]) };
				if (parts[2].length === 4) return { day: Number(parts[0]), month: Number(parts[1]), year: Number(parts[2]) };
			}
			const parsed = new Date(val);
			if (!isNaN(parsed)) return { day: parsed.getDate(), month: parsed.getMonth() + 1, year: parsed.getFullYear() };
			return null;
		}

		compute.addEventListener('click', () => {
			clearError();
			out.style.display = 'none';
			const raw = dob.value;
			if (!raw) {
				showError('× × ×œ×‘×—×•×¨ ×ª××¨×™×š ×œ×™×“×”.');
				return;
			}

			const parsed = parseDateInput(raw);
			if (!parsed) {
				showError('×œ× × ×™×ª×Ÿ ×œ×§×¨×•× ××ª ×”×ª××¨×™×š. ×”×©×ª××©×• ×‘×‘×•×¨×¨ ××• ×”×–×™× ×• yyyy-mm-dd ××• dd/mm/yyyy.');
				return;
			}

			let { day, month, year } = parsed;
			const check = new Date(year, month - 1, day);
			if (check.getFullYear() !== Number(year) || (check.getMonth() + 1) !== Number(month) || check.getDate() !== Number(day)) {
				showError('×ª××¨×™×š ×œ× ×—×•×§×™. ×‘×“×§×• ×•× ×¡×• ×©×•×‘.');
				return;
			}

			const daySum = sumDigitsOnce(day);
			const monthReduced = digitalRoot(sumDigitsOnce(month));
			const yearReduced = digitalRoot(year);
			const total = digitalRoot(daySum + monthReduced + yearReduced);

			showOutput(daySum, monthReduced, yearReduced, total);

			// Show enhanced payment section with animation
			const payBtn = document.getElementById('paylink');
			const paymentSection = document.getElementById('payment-section');
			out.classList.add('visible');
			out.style.display = 'block';
			payBtn.setAttribute('aria-hidden', 'false');
			
			// Show payment section after result appears
			setTimeout(() => {
				paymentSection.style.display = 'block';
				setTimeout(() => paymentSection.classList.add('show'), 50);
			}, 400);
		});

		clearBtn.addEventListener('click', () => {
			dob.value = '';
			out.style.display = 'none';
			out.classList.remove('visible');
			const payBtn = document.getElementById('paylink');
			const paymentSection = document.getElementById('payment-section');
			payBtn.classList.remove('show');
			paymentSection.classList.remove('show');
			paymentSection.style.display = 'none';
			payBtn.setAttribute('aria-hidden', 'true');
			clearError();
			dob.focus();
		});

		dob.addEventListener('keydown', (e) => {
			if (e.key === 'Enter') compute.click();
		});

		// Payment flow
		const paylink = document.getElementById('paylink');
		function buildReturnUrl() {
			return encodeURIComponent(window.location.origin + window.location.pathname + window.location.search);
		}

		paylink.addEventListener('click', (e) => {
			e.preventDefault();
			const href = `pay.html?return=${buildReturnUrl()}&amount=5`;
			window.location.href = href;
		});

		// Show interpretations if paid
		const params = new URLSearchParams(window.location.search);
		if (params.get('paid') === '1') {
			document.getElementById('interpretations').style.display = 'block';
			document.getElementById('interpretations').setAttribute('aria-hidden', 'false');
		}
	</script>

	<script>
		// Register service worker for PWA
		if ('serviceWorker' in navigator) {
			window.addEventListener('load', function() {
				navigator.serviceWorker.register('sw.js').catch(function(err) {
					console.info('SW registration failed:', err);
				});
			});
		}
	</script>
</body>
</html>

